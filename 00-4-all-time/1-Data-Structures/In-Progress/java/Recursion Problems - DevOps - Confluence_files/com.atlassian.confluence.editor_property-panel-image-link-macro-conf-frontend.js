WRMCB=function(e){var c=console;if(c&&c.log&&c.error){c.log('Error running batched script.');c.error(e);}}
;
try {
/* module-key = 'com.atlassian.confluence.editor:property-panel-image-link-macro-conf-frontend', location = 'tinymce3/plugins/imagedialog/editor_plugin_src.js' */
define("confluence-editor/tinymce3/plugins/imagedialog/editor_plugin_src",["tinymce","confluence/legacy-editor-global-AVOID-IF-POSSIBLE"],function(a,b){return{init:function(a){a.onInit.add(function(){a.addCommand("mceConfimage",b.defaultInsertImageDialog)})},getInfo:function(){return{longname:"Confluence Image Dialog",author:"Atlassian",authorurl:"http://www.atlassian.com",version:a.majorVersion+"."+a.minorVersion}}}});
require("confluence/module-exporter").safeRequire("confluence-editor/tinymce3/plugins/imagedialog/editor_plugin_src",function(a){var b=require("tinymce");b.create("tinymce.plugins.ConfluenceImageDialog",a);b.PluginManager.add("confluenceimagedialog",b.plugins.ConfluenceImageDialog)});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.editor:property-panel-image-link-macro-conf-frontend', location = 'utils/tinymce-image-utils.js' */
define("confluence-editor/utils/tinymce-image-utils","jquery confluence/api/logger confluence/meta ajs tinymce confluence/api/constants confluence/property-panel".split(" "),function(d,h,q,l,n,r,m){var o=["imagetext","src","align","border","width","height"],s=/\/download\/(thumbnails|attachments)\/([0-9]+)\//,p=function(a,b,g,c,e){if(c){if(b>=e)a.width=e;a.style.maxWidth=""}else{if(g>=e)a.height=e;a.style.maxHeight=""}},i;i={isScaledByWidth:function(){return false},updateImageElement:function(a,b){var g=
d(a),c;c=b.destination;c=i.isRemoteImg(c)?c:b.thumbnail?c.replace("/attachments/","/thumbnails/"):c.replace("/thumbnails/","/attachments/");b.src=c;g.toggleClass("confluence-content-image-border",!!b.border);g.toggleClass("confluence-thumbnail",!!b.thumbnail);c=0;for(var e=o.length;c<e;c++){var f=o[c],j=b[f];j!==false&&j!=null?g.attr(f,j):g.removeAttr(f)}n.activeEditor.undoManager.add()},insertFromProperties:function(a,b){d.ajax({type:"POST",contentType:"application/json; charset=utf-8",url:r.CONTEXT_PATH+
"/rest/tinymce/1/embed/placeholder/image",data:d.toJSON(a),dataType:"text",success:function(a){i.insertImagePlaceholder(a,b)}})},insertImagePlaceholder:function(a,b){var g,c=i.isScaledByWidth(),e=d(a);g=c?m.Image.getPresetImageSize("large"):q.get("content-type")==="comment"?m.Image.getPresetImageSize("small"):m.Image.getPresetImageSize("medium");e.css(c?"max-width":"max-height",g+"px");var f=n.activeEditor,j="_"+ +new Date,h=d("<div></div>").append(e.attr("id",j));f.selection.setContent(h.html());
var k=f.dom.get(j);f.dom.setAttrib(k,"id","");e.hasClass("confluence-external-resource")||p(k,e.attr("data-image-width"),e.attr("data-image-height"),c,g);d(k).one("load",function(){e.hasClass("confluence-external-resource")&&p(this,this.width,this.height,c,g);l.Rte.showSelection(function(){b||l.trigger("trigger.property-panel",{elem:k});f.undoManager.add()});f.onChange.dispatch()})},isRemoteImg:function(a){var b=l.Rte.getCurrentBaseUrl();return a.match("(https?://)")&&a.indexOf(b)===-1},isThumbnailUsable:function(a,
b,d,c,e,f){if(a){if(a>e)return false;e=d/c;return e>=1?true:e*f>=a}a=b;if(a>f)return false;f=c/d;return f>=1?true:f*e>=a}};return{ImageProperties:function(a){if(a&&d.nodeName(a,"img")&&d(a).hasClass("confluence-embedded-image")){var b=d(a),a={destination:b.attr("src"),url:b.attr("src"),border:b.attr("class")&&b.attr("class").indexOf("confluence-content-image-border")!==-1?1:0,width:b.prop("width"),height:b.prop("height"),originalSelected:!b.attr("width")&&!b.attr("height")};if(!i.isRemoteImg(a.destination)&&
!d(b).hasClass("confluence-external-resource")){var g=a;var b=d(b).attr("src"),c=b.match(s);if(c&&c.length===3)b=c[2];else{h.log("ERROR: could not parse page id from image url "+b);b="0"}g.pageId=b}return d.extend({},a)}if(a.destination){a.imageFileName=a.imageFileName||a.destination;return d.extend({},a)}return null},ImageUtils:i}});
require("confluence/module-exporter").safeRequire("confluence-editor/utils/tinymce-image-utils",function(d){var h=require("tinymce");h.confluence.ImageProperties=d.ImageProperties;h.confluence.ImageUtils=d.ImageUtils});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.editor:property-panel-image-link-macro-conf-frontend', location = 'utils/tinymce-macro-utils.js' */
define("confluence-editor/utils/tinymce-macro-utils",["tinymce","ajs","confluence/legacy-editor-global-AVOID-IF-POSSIBLE","jquery","confluence/get-content-id"],function(h,f,l,e,p){var n,o=function(a,c){var d;if(a.macro&&a.contentId)d={type:"POST",url:f.contextPath()+"/rest/tinymce/1/macro/placeholder",contentType:"application/json; charset=utf-8",data:e.toJSON(a),dataType:"text"};else if(a.url&&a.type)d=a;else throw Error("illegal argument received: "+a);var b=e.Deferred(),g=f.Rte.getEditor(),i,m;
c||(m="macro-"+(new Date).getTime(),i=g.dom.create("span",{id:m}),g.selection.setNode(i),c=i=g.dom.select("#"+m)[0],b.fail(function(){e(i).remove()}));e.extend(d,{timeout:n.DEFAULT_INSERT_MACRO_TIMEOUT});f.debug("Insert macro timeout = "+d.timeout);l.UI.setButtonsState(!1);e.ajax(d).done(function(j){j[0]!=="<"&&(j=document.createTextNode(j));if(!c||!c.parentNode){f.logError("The node to be replaced has been already deleted from the document");b.rejectWith(this,arguments)}else h.confluence.NodeUtils.updateNode(c,
j).done(function(a){b.resolve(a,j)}).fail(b.reject)}).fail(function(a,c,e){f.logError("Macro placeholder request failed "+c+": '"+e+"'");b.rejectWith(this,arguments)});b.done(function(a,c){l.UI.setButtonsState(true);h.confluence.macrobrowser.isMacroWithBody(a)&&/P|H\d/.test(a.parentNode.nodeName)&&g.dom.split(a.parentNode,a);var b=h.confluence.macrobrowser,d=h.activeEditor,i=d.getDoc(),k=d.selection.getRng(true);if(b.isMacroWithBody(a)){!h.isIE&&e("p, pre",a).each(function(){this.childNodes.length===
0&&this.appendChild(i.createElement("br"))});if(b=d.dom.select(".wysiwyg-macro-body",a)[0].firstChild){k.setStart(b,0);k.setEnd(b,0)}else f.debug("focusMacroNode: couldn't find anything to focus, cap'n!")}else{k.setStartAfter(a);k.setEndAfter(a)}d.selection.setRng(k);g.nodeChanged();f.Rte.showElement(a);g.selection.onSetContent.dispatch(g.selection,{content:c,format:"html"});h.activeEditor.undoManager.add();f.trigger("macro-browser.macro-inserted")}).fail(function(){l.UI.setButtonsState(true)});return b.promise()};
return n={DEFAULT_INSERT_MACRO_TIMEOUT:5E3,insertMacro:o,isInMacro:function(a){return 0<(a.jquery?a:e(a)).closest(".wysiwyg-macro").length},updateMacro:function(a,c,d,b){a={contentId:p(),macro:{name:d,params:a,body:c?c:""}};return o(a,b)}}});require("confluence/module-exporter").exportModuleAsGlobal("confluence-editor/utils/tinymce-macro-utils","tinymce.confluence.MacroUtils");
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.editor:property-panel-image-link-macro-conf-frontend', location = 'tinymce3/plugins/propertypanel/js/property-panel-links.js' */
define("confluence-editor/tinymce3/plugins/propertypanel/js/property-panel-links","ajs jquery confluence/legacy-editor-global-AVOID-IF-POSSIBLE tinymce window confluence/property-panel".split(" "),function(d,e,j,k,l,g){var i=0;return{name:"link",canHandleElement:function(c){return c.is("a")&&c.attr("href")!="#"&&!c.hasClass("unresolved")&&c.data("linkedResourceType")!=="userinfo"},handle:function(c){var b=c.containerEl,h=c.ed,a=function(b){return d.Rte.getEditor().getLang(b)},c={anchorIframe:d.Rte.getEditorFrame()},
f=e(b).attr("href").indexOf("#")===0,a=[{className:"link-property-panel-goto-button",text:a("propertypanel.links_goto"),tooltip:f?a("propertypanel.links_goto_disabled_tooltip"):b.href,href:b.href,disabled:f,click:function(){g.destroy();var a=l.open(b.href,k.isIE?"_blank":"confluence-goto-link-"+d.params.pageId+"-"+i);a&&a.focus()}},{className:"link-property-panel-edit-button",text:a("propertypanel.links_edit"),tooltip:a("propertypanel.links_edit_tooltip"),disabled:e(b).hasClass("createlink")||!b.href,
click:function(){g.destroy();h.selection.select(b);j.LinkBrowser.open({bookmarkManager:d.Rte.BookmarkManager})}},{className:"link-property-panel-unlink-button",text:a("propertypanel.links_unlink"),tooltip:a("propertypanel.links_unlink_tooltip"),click:function(){g.destroy();h.execCommand("mceConfUnlink",false,b);h.focus()}}],f=[];d.trigger("link-property-panel-buttons.created",{buttons:f,link:b});a=a.concat(f);g.createFromButtonModel(this.name,b,a,c);i++}}});
require("confluence/module-exporter").exportModuleAsGlobal("confluence-editor/tinymce3/plugins/propertypanel/js/property-panel-links","AJS.Confluence.PropertyPanel.Link",function(d){var e=require("ajs");e.bind("init.rte",function(){e.trigger("add-handler.property-panel",d)})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.editor:property-panel-image-link-macro-conf-frontend', location = 'tinymce3/plugins/propertypanel/js/property-panel-macros.js' */
define("confluence-editor/tinymce3/plugins/propertypanel/js/property-panel-macros","ajs tinymce jquery document confluence/macro-js-overrides confluence-editor/utils/tinymce-macro-utils underscore confluence/property-panel confluence-macro-browser/macro-parameter-serializer confluence/dark-features".split(" "),function(c,q,e,u,r,A,i,s,y,B){var t=[],v=[],l={},j="__PROPERTY_PANEL_SPACER",m={key:j},k,g,o=function(a,e,d){Array.isArray(a)||(a=[a]);a.forEach(function(b){i.contains(i.pluck(t,"id"),b)||t.push({id:b,
handler:e,macroName:d})})},z=function(a,n,d){a=i.map(a,function(b){return b.type==="button"?[{key:b.key,label:b.label.value},m]:b.type==="group"&&b.controls.length>0?i.map(b.controls,function(b){return{key:b.key,label:b.label.value}}).concat(m):b.type==="togglegroup"&&b.controls.length>0?i.map(b.controls,function(a){var h={key:a.key,label:a.label.value,group:b.macroParameter,selected:d[b.macroParameter]===a.macroParameterValue},i=a.macroParameterValue,j=b.macroParameter;o(h.key,function(a,b,d){var f=
{};f[j]=i;a=k;b=c.MacroBrowser.getMacroParams(a);e.extend(b,f);f=e(a).find(".wysiwyg-macro-body").text();A.updateMacro(b,f,n,a).done(function(a){d.parent().children().filter(".macro-property-group-"+j).removeClass("selected");d.addClass("selected");k=a;g=e(k)})},n);return h}).concat(m):m});return i.flatten(a)};return{name:"macro",registeredEvents:t,canHandleElement:function(a){return a.hasClass("editor-inline-macro")||a.hasClass("wysiwyg-macro")},handle:function(a){function n(){var a="macro-placeholder-property-panel-remove-button";
b.length>0&&b[b.length-1].key==j&&(a=a+" first");h.push({className:a,text:"Remove",click:function(){s.destroy();c.Rte.getEditor().execCommand("mceConfRemoveMacro",k)}});if(g.attr("data-macro-parameters")){var p=y.deserialize(g.attr("data-macro-parameters"));if("atlassian-macro-output-type"in p){a=function(a){return function(b){p["atlassian-macro-output-type"]=a;g.attr("data-macro-parameters",y.serialize(p));a=="INLINE"?e(".macro-placeholder-property-panel-display-newline-button").removeClass("selected"):
e(".macro-placeholder-property-panel-display-inline-button").removeClass("selected");e(b).addClass("selected")}};h.push(null);h.push({className:"macro-placeholder-property-panel-display-newline-button",tooltip:"Display on new line",selected:p["atlassian-macro-output-type"]=="BLOCK",click:a("BLOCK")});h.push({className:"macro-placeholder-property-panel-display-inline-button",tooltip:"Display inline",selected:p["atlassian-macro-output-type"]==
"INLINE",click:a("INLINE")})}}e.each(t,function(){(!this.macroName||this.macroName==d)&&e(u).bind(w(this.id,this.macroName),this.handler)});a=v;d&&l[d]&&(a=a.concat(l[d]));e.each(a,function(){try{this(k,h,o)}catch(a){c.debug("Property panel init handler failed for : "+d+".  Is global handler : "+(e.inArray(this,v)>-1),a)}});if(h.length>0){var a=s.createFromButtonModel("macro",k,h,o),f=r.getFunction(d,"propertyPanelIFrameInjector");f&&f(a)}}if(!(a.e.type!=="click"&&a.e.type!=="mouseup")){k=a.containerEl;
g=e(k);var d,b=[],a=!g.hasClass("editor-inline-macro"),i=!g.hasClass("wysiwyg-unknown-macro"),h=[],o={originalHeight:a&&g.height(),anchorIframe:c.Rte.getEditorFrame()},w=function(a,b){return a+"-button-click"+(b?b+".macro":"")+".property-panel"};if(g.attr("data-macro-name")!=="portfolioforjiraplan"||B.isEnabled("portfolio.for.jira.macro"))if(i){var x=e.Deferred();d=g.attr("data-macro-name");if(c.MacroBrowser.getMacroMetadata(d))b=c.MacroBrowser.getMacroMetadata(d).buttons;(a=r.getFunction(d,"waitForPropertyPanelEventBindings"))&&
a();(a=r.getFunction(d,"getControls"))?a(function(a){var e=b,a=z(a,d,c.MacroBrowser.getMacroParams(g[0]));b=e.concat(m).concat(a);x.resolve()}):x.resolve();x.done(function(){var a="macro-placeholder-property-panel-edit-button";b.length>0&&b[0].key===j&&(a=a+" last");h.push({className:a,text:"Edit",click:function(){s.destroy();q.confluence.macrobrowser.editMacro(g)}});e.each(b,function(a,f){if(f.key!=j){var c="macro-property-panel-"+f.key;f.group&&(c=c+(" macro-property-group-"+
f.group));a>0&&b[a-1].key==j&&(c=c+" first");a<b.length-1&&b[a+1].key==j&&(c=c+" last");h.push({className:c,text:f.label,parameterName:f.key,click:function(a){e(u).trigger(w(f.key),g);e(u).trigger(w(f.key,d),[g,e(a)]);var b=r.getFunction(d,"handlePropertyPanelEvent");if(b){a.attr("aria-disabled","true");setTimeout(function(){if(a.attr("aria-disabled")==="true"){a.find(".panel-button-text").css("visibility","hidden");a.spin()}},2E3);b("click",f.key,d).done(function(){a.attr("aria-disabled","false");
a.find(".panel-button-text").css("visibility","visible");a.spinStop()})}else s.destroy()},selected:f.selected})}})}).then(n())}else n()}},registerButtonHandler:o,registerInitHandler:function(a,c){if(c){l[c]=l[c]||[];l[c].push(a)}else v.push(a)},yieldButtonFor:function(a,c){var d;e.each(a,function(){this.parameterName&&this.parameterName==c&&(d=this)});return d},_convertToMacroButtons:z}});
require("confluence/module-exporter").exportModuleAsGlobal("confluence-editor/tinymce3/plugins/propertypanel/js/property-panel-macros","AJS.Confluence.PropertyPanel.Macro",function(c){var q=require("ajs");q.bind("init.rte",function(){q.trigger("add-handler.property-panel",c)})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.editor:property-panel-image-link-macro-conf-frontend', location = 'tinymce3/plugins/propertypanel/js/property-panel-images.js' */
define("confluence-editor/tinymce3/plugins/propertypanel/js/property-panel-images","jquery ajs tinymce confluence-editor/utils/tinymce-image-utils confluence/meta confluence/api/browser confluence/property-panel confluence/legacy-editor-global-AVOID-IF-POSSIBLE".split(" "),function(f,g,s,F,v,G,h,w){function x(){var a=[];f.each(t,function(b,c){a.push(c)});h.current.panel.find(a.join(", ")).removeClass("selected")}function p(a,b,c){var e=y(a,b),c=y(a,c),j=e||c;if(j){var d=h.getAnchor(),i=d.width(),
d=d.height(),f=v.get("max-thumb-width"),g=v.get("max-thumb-height");a.thumbnail=k.isRemoteImg(a.destination)?false:k.isThumbnailUsable(e,c,i,d,f,g);a.originalSelected=false;if(b){delete a.height;a.width=j}else{delete a.width;a.height=j}m(a);x();return true}return false}function z(a,b){if(u?p(a,n[b]):p(a,null,n[b])){A(b);m(a);return true}return false}function B(a){delete a.width;delete a.height;a.thumbnail=false;a.originalSelected=true;x();A("original");var b=h,c=b.getAnchor();b.current.updating=true;
c.one("load",function(){l(b);q(a);a.width=Math.floor(c.width());a.height=Math.floor(c.height())});k.updateImageElement(c,a);s.isGecko&&g.Rte.getEditor().execCommand("mceRepaint",false);c.each(function(){this.complete&&f(this).trigger("load")});return true}function A(a){h.current.panel.find(t[a]).addClass("selected")}function C(a){f(".image-border-toggle").toggleClass("selected",!a.border);a.border=+!a.border||false;m(a)}function m(a){var b=h,c=b.getAnchor(),e=c.attr("src"),f=c.height();b.current.updating=
true;k.updateImageElement(c,a);s.isGecko&&g.Rte.getEditor().execCommand("mceRepaint",false);if(a.src!=e){var d=setInterval(function(){var a=c.height();if(a!=f){g.debug("updateImageElement : height changed after image src change - "+f+" to "+a);clearTimeout(d);d=null;l(b)}},10);setTimeout(function(){if(d){clearTimeout(d);d=null;l(b)}},1E3)}else l(b);q(a)}function q(a){a=a.width?a.width:h.getAnchor().width();a=Math.floor(a);f("#image-size-input").val(a+"px")}function y(a,b){b=parseInt(b);if(isNaN(b))return null;
b<D?b=D:b>E&&(b=E);return b}var k=F.ImageUtils,u=k.isScaledByWidth(),n;n=u?{small:100,medium:300,large:500}:{small:150,medium:250,large:400};var t={small:".image-size-small",medium:".image-size-medium",large:".image-size-large",original:".image-size-original"},D=16,E=9E4,l=function(a){a.current.updating=false;a.current.snapToElement({animate:true,animateDuration:100})};return{_resizeImage:p,pluginButtons:[],name:"image",getPresetImageSize:function(a){return n[a]},canHandleElement:function(a){return a.is("img")&&
!a.hasClass("editor-inline-macro")&&!a.hasClass("template-variable")},handle:function(a){function b(){p(e,f("#image-size-input").val())?true:q(e);g.trigger("analyticsEvent",{name:"confluence.editor.image.resize.custom"})}var c;c=a.nodeName==="IMG"?a:a.containerEl;var a=f(c),e=s.confluence.ImageProperties(c);if(e&&!a.attr("data-resource-id")){var j=g.Rte.getEditor(),d=function(a){return j.getLang(a)},i=function(a){return{className:"image-size-"+a,text:d("propertypanel.images_"+a),tooltip:d("propertypanel.images_"+
a+"_tooltip"),click:function(){z(e,a);g.trigger("analyticsEvent",{name:"confluence.editor.image.resize."+a})},selected:u?e.width==n[a]:e.height==n[a]}},i=[{className:"editable",tooltip:d("propertypanel.images_sizing_tooltip"),html:'<input id="image-size-input"/>'},null,i("small"),i("medium"),i("large"),{className:"image-size-original",text:d("propertypanel.images_original"),tooltip:d("propertypanel.images_original_tooltip"),click:function(){B(e);g.trigger("analyticsEvent",{name:"confluence.editor.image.resize.original"})},
selected:e.originalSelected},null,{className:"image-border-toggle",text:d("propertypanel.images_border"),tooltip:d("propertypanel.images_border_tooltip"),click:function(){C(e)},selected:e.border||e.border==1}];i.push(null);var k=a.parent();if(k.is("a[href]")){i.push({className:"image-link-edit",text:d("propertypanel.images_link_edit"),tooltip:d("propertypanel.images_link_edit_tooltip"),click:function(){h.destroy();j.selection.select(k[0]);w.LinkBrowser.open()}});i.push({className:"image-link-remove",
text:d("propertypanel.images_link_remove"),tooltip:d("propertypanel.images_link_remove_tooltip"),click:function(){h.destroy();j.execCommand("mceConfUnlink",false,c);j.focus()}})}else i.push({className:"image-make-link",text:d("propertypanel.images_link_create"),tooltip:d("propertypanel.images_link_create_tooltip"),click:function(){h.destroy();j.selection.select(c);w.LinkBrowser.open()}});for(var l=h.Image.pluginButtons,r=0;r<l.length;r++)if(l[r]===null)i.push(null);else{var m=l[r].create(a);m&&i.push(m)}h.createFromButtonModel(this.name,
c,i,{anchorIframe:g.Rte.getEditorFrame()});a=f("#image-size-input");a.bind("focus",function(){f(this).select()});a.bind("change",function(){b()});(new G(window.navigator.userAgent)).isIE()&&a.bind("keyup",function(a){a.keyCode===13&&b()});h.current.imageProps=e;q(e);var o=e;return{setPresetSize:function(a){z(o,a)},setPixelSize:function(a){p(o,a)},setToOriginalSize:function(){B(o)},toggleBorder:function(){C(o)},getWidth:function(){return o.width},getHeight:function(){return o.height},getDisplayWidth:function(){return f("#image-size-input").val()},
isButtonSelected:function(a){return h.current.panel.find(t[a]).hasClass("selected")}}}}}});require("confluence/module-exporter").exportModuleAsGlobal("confluence-editor/tinymce3/plugins/propertypanel/js/property-panel-images","AJS.Confluence.PropertyPanel.Image",function(f){var g=require("ajs");g.bind("init.rte",function(){g.trigger("add-handler.property-panel",f)})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.editor:property-panel-image-link-macro-conf-frontend', location = 'tinymce3/plugins/imageproperties/js/image-properties-dialog.js' */
define("confluence-editor/tinymce3/plugins/imageproperties/js/image-properties-dialog",["jquery","ajs","confluence/dialog","confluence/property-panel"],function(d,a,p,l){function m(){f||(f=d("#image-properties-tab-items > div").map(function(){var e=d(this);return{key:e.text(),weight:e.attr("data-weight"),label:this.title}}).sort(function(e,b){return e.weight-b.weight}));return f}function n(){var e=c.popup.element,b=650/60,a=d('<div class="image-properties-loading-blanket"><div class="loading-data"></div></div>').appendTo(e.find(".dialog-page-body")),
g=a.find(".loading-data");a.css({width:a.parent().width(),height:e.height()});g.css({marginTop:-60,marginLeft:-60});g.spin({color:"#666",width:b,radius:25,length:25,top:0,left:0,zIndex:0,speed:1.042});var e=[],h;for(h in i)b=i[h],(b=b.saveFn&&b.saveFn())&&b.done&&e.push(b);d.when.apply(d,e).done(function(){var a=c.popup.element.find(".image-properties-loading-blanket .loading-data");a.css({marginTop:"",marginLeft:""});a.spinStop();a.closest(".image-properties-loading-blanket").remove();c.hide().remove()})}
function q(){c.hide().remove()}var c,f,i={},o;return{init:function(){o||(f=null,0<m().length&&(o=!0,l.Image.pluginButtons.push(null,{create:function(){return{className:"image-properties",text:"Properties",tooltip:"Set additional image properties",click:function(e,b){a.trigger("analyticsEvent",{name:"confluence.editor.image-properties-trigger"});l.destroy();d("#image-properties-dialog").remove();c=new p.component({id:"image-properties-dialog",onSubmit:n});
a.trigger("dialog-created.image-properties",{img:b});c.popup.element.attr("data-tab-default","0");c.addHeader("Image Properties");c.addSubmit("Save",n);c.addCancel("Cancel",q);for(var f=c,g=m(),h=0;h<g.length;h++){var j=g[h],k=i[j.key];k&&f.addPanel(j.label,k.content,k.panelClass,j.key)}1===g.length&&f.popup.element.find(".dialog-page-menu").show();a.trigger("dialog-before-show.image-properties");
c.show()}}}})))},registerPanel:function(a,b,c,d){i[a]={content:b,panelClass:c,saveFn:d}}}});require("confluence/module-exporter").exportModuleAsGlobal("confluence-editor/tinymce3/plugins/imageproperties/js/image-properties-dialog","Confluence.Editor.ImageProps",function(d){var a=require("ajs");a.toInit(d.init);a.bind("quickedit.success",d.init)});
}catch(e){WRMCB(e)};