WRMCB=function(e){var c=console;if(c&&c.log&&c.error){c.log('Error running batched script.');c.error(e);}}
;
try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:manage-event', location = 'com/atlassian/confluence/extra/calendar3/components/manage-event/manage-event.js' */
define("tc/manage-event",["jquery","tc/event-delete-dialog","tc/calendar-util"],function(c,a,b){var d=function(g,e){var h;function f(n,l,j,i,m,k){if(!l.end&&!m){l.end=new Date(l.start.getTime()+(1000*60*60*2))}g.setProcessingEvent(n,true);g.setSuppressEventToolTip(n,true);d(g,e).updateEvent(n,(function(){var p=g.getSubCalendar(n,l.subCalendarId),o={subCalendarId:p.parentId,uid:l.id,eventType:l.eventType,originalStartDate:l.originalStart||"",what:l.title,url:l.workingUrl,dragAndDropUpdate:true,start:c.fullCalendar.formatDate(l.start,"ddMMyyyyHHmm"),end:c.fullCalendar.formatDate(l.end||l.start,"ddMMyyyyHHmm"),allDayEvent:m,where:l.where,description:l.description,freq:l.recur?l.recur.freq:"",byday:l.recur?l.recur.byDay:"",interval:l.recur?l.recur.interval:"",until:l.recur?l.recur.localizedUntil||"":"",recurrenceId:l.recurId||"",editAllInRecurrenceSeries:"false",customEventTypeId:l.customEventTypeId,childSubCalendarId:l.subCalendarId||""};if(p.eventInviteesSupported){o.person=c.map(l.invitees||[],function(q){return q.id})}return o})(),function(o,q,p){g.showAjaxError(n,o,q,p,g.ERROR_CLASS_EVENT_UPDATE);k();g.setSuppressEventToolTip(n,false);g.setProcessingEvent(n,false)},function(p){if(p.success){g.setGenericErrors(n,null,g.ERROR_CLASS_EVENT_UPDATE);var o=p.event;c.each(g.getCalendarPanel(n).fullCalendar("clientEvents",l.id),function(r,q){q.localizedStartDate=o.localizedStartDate;q.localizedStartTime=o.localizedStartTime;q.localizedEndDate=o.localizedEndDate;q.localizedEndTime=o.localizedEndTime;q.recurId=o.recurId;q.invitees=o.invitees;q.iconUrl=o.iconUrl;q.confluenceFormattedStartDate=o.confluenceFormattedStartDate;q.expandDates=o.expandDates;if(o.extraProperties){q.extraProperties=o.extraProperties}});if(l.calendarReloadRequiredOnUpdate){g.reloadSubCalendar(n,[l.subCalendarId])}}else{g.setGenericErrors(n,"Uh oh. Looks like something unexpectedly went wrong. Please check the Confluence log file.",g.ERROR_CLASS_EVENT_UPDATE);k()}g.setSuppressEventToolTip(n,false);g.setProcessingEvent(n,false)})}return{getEventDetailsDialog:function(r,j,p,i){var m=g.getSubCalendar(r,j.subCalendarId),k=g.getSubCalendar(r,m.parentId),q=(function(){return(c.inArray(g.getCalendarPanel(r).fullCalendar("getView").name,["month","agendaWeek"])!==-1)||g.getParameter(r,"showSubCalendarNameInEventPopup")!=="true"})(),o=function(){var w=null;var v=k?k:m;if(b.isCustomEventType(j.eventType)){var s=v.customEventTypes;c.each(s,function(x,y){if(y.customEventTypeId===j.customEventTypeId&&y.periodInMins>0){w=AJS.format("{0} before",b.showInforReminder(y.periodInMins));return false}})}else{var u=v.sanboxEventTypeReminders;if(u&&u.length>0){var t=j.eventType;if(b.isJiraType(t)){t+="-calendar"}c.each(u,function(y,x){if(x.eventTypeId===t&&x.periodInMins>0){w=AJS.format("{0} before",b.showInforReminder(x.periodInMins));return false}})}}return w},n=function(){return c("<div/>").html(Confluence.TeamCalendars.Templates.eventPopup({contextClass:q?"mycalendars":"",baseUrl:g.getParameter(r,"baseUrl"),event:c.extend(c.extend({},j),{colour:m.color,subCalendarDisplayName:k&&!Confluence.TeamCalendars.isSubscriptionSubCalendar(m)?k.name:m.name,subCalendarId:k?k.id:m.id,inviteesSupported:m.inviteesSupported,period:o()})}))},l=AJS.InlineDialog(p,g.dialogSequence++,function(u,s,w){var t=n();c(".field-duration",t).each(function(){var x=c(this);if(j.localizedStartDate!==j.localizedEndDate){x.empty().html("<span class='aui-icon aui-icon-wait'></span>");g.formatDate(r,[j._start,j._end],"dd MMM",function(y){if(typeof y==="string"){x.text(y);return}if(j.allDayFlipped?!j.allDay:j.allDay){x.empty().text(AJS.format("{0} - {1}",y[0],y[1]))}else{x.empty().text(AJS.format("{0}, {1} - {2}, {3}",y[0],j.localizedStartTime,j.localizedEndTime,y[1]))}})}else{if(!((j.allDayFlipped?!j.allDay:j.allDay))){x.empty().text(j.localizedStartTime+" - "+j.localizedEndTime)}}});var v=c(".edit-controls",t);if(g.isEventEditable(r,j)){v.each(function(){if(g.getParameter(r,"redirectEditInEventPopup")==="true"){c(".event-edit",this).unbind("click").attr("href",g.getParameter(r,"baseUrl").concat("/calendar/mycalendar.action","?startDayOfMonth=",c.fullCalendar.formatDate(j.start,"d"),"&startMonthOfYear=",(parseInt(c.fullCalendar.formatDate(j.start,"M"))-1),"&startYear=",c.fullCalendar.formatDate(j.start,"yyyy"),"&editSubCalendarId=",encodeURIComponent(g.getSubCalendar(r,j.subCalendarId).id),"&editEventId=",encodeURIComponent(j.id),"&editView=month"))}else{c(".event-edit",this).unbind("click").click(function(){l.hide();var z=g.getSubCalendar(r,j.subCalendarId),y=Confluence.TeamCalendars.Dialogs.getEditEventDialog(c.extend({},j,{eventType:z.subscriptionType||z.type,subCalendarId:z.parentId,originalEventSubCalendarId:z.id,childSubCalendarId:j.subCalendarId||""}),null,g,r);y.show();return false})}var x=c(".event-delete",this);if(g.isEventDeletable(r,j)&&g.getParameter(r,"hideDeleteInEventPopup")==="false"){x.click(function(){l.hide();a(r,j,g).show();return false})}else{x.remove()}})}else{v.each(function(){c(".edit-control",this).remove()})}v.each(function(){c(".event-hyperlink-separator:first-child, .event-hyperlink-separator:last-child",this).remove()});t.appendTo(u.empty());w()},(function(){var s={hideDelay:0,noBind:true,isRelativeToMouse:true,showDelay:0,width:c.inArray("jira-version",j.className)!==-1?380:360,hideCallback:function(){g.setSuppressEventToolTip(r,false);if(AJS.InlineDialog.current&&AJS.InlineDialog.current.popup){AJS.InlineDialog.current.popup.hide()}},initCallback:function(){g.setSuppressEventToolTip(r,true);c(".event-field.reminder-icon").tooltip({gravity:"s"})}};return i?c.extend(s,i):s})());l.addClass("event-display-dialog");return l},updateEvent:function(m,l,j,i){l.userTimeZoneId=Confluence.TeamCalendars.getUserTimeZone();var k=g.setSubCalendarSpinnerIconVisible(true);c.ajax({cache:false,data:l,dataFilter:function(o){var n=c.parseJSON(o);if(n.success){Confluence.TeamCalendars.mergeSubCalendarObjectsToArray([n.subCalendar])}return n},dataType:"text",error:function(n,p,o){if(j){j(n,p,o)}},success:function(o){var p=l.eventType,n=g.getParameter(m,"calendarContext");var q;if(p==="custom"){if(o.subCalendar&&o.subCalendar.customEventTypes){c.each(o.subCalendar.customEventTypes,function(r,s){if(s.customEventTypeId===l.customEventTypeId){q={customEventTypeName:s.title}}})}}if(l.uid){Confluence.TeamCalendars.fireEventForAnalytics("event.update.default."+p+".context."+n,q)}else{Confluence.TeamCalendars.fireEventForAnalytics("event.create.default."+p+".context."+n,q)}e.removeCalendar(l.subCalendarId);e.removeCalendar(l.originalSubCalendarId);if(i){i(o)}g.reloadSubCalendarDisableEvent(m,l)},complete:function(){if(k){k.resolve()}},type:"PUT",timeout:g.ajaxTimeout,url:g.getCalendarServiceBaseUrl(m,"/events.json")})},deleteEvent:function(k,l,j,i){c.ajax({cache:false,data:l,dataType:"json",error:function(m,o,n){if(j){j(m,o,n)}},success:function(m){e.removeCalendar(l.subCalendarId);if(i){i(m)}},type:"DELETE",timeout:g.ajaxTimeout,url:g.getCalendarServiceBaseUrl(k,"/events.json")})},eventClick:function(j,i,k){g.setEventTooltipVisible(k);if(i.shiftKey){if(g.isEventEditable(k,j)){var l=g.getSubCalendar(k,j.subCalendarId);Confluence.TeamCalendars.Dialogs.getEditEventDialog(c.extend({},j,{eventType:l.subscriptionType||l.type,subCalendarId:l.parentId,originalEventSubCalendarId:l.id,childSubCalendarId:j.subCalendarId||""}),null,g,k).show()}return false}if((i.ctrlKey||i.metaKey)&&j.workingUrl){window.location=j.workingUrl;return false}g.getEventDetailsDialog(k,j,c(i.currentTarget)).show(i);return false},eventRender:function(j,m,i,k){if(j.disableResizing){c(".ui-resizable-handle",m).hide()}m.mousemove(function(n){m.data("mouseCoords",{pageX:n.pageX,pageY:n.pageY})}).hover(function(){setTimeout(function(){var n=m.data("mouseCoords");if(!g.isEventToolTipSuppressed(k)&&n){g.setEventTooltipVisible(k,j,n,true)}},5000)},function(){m.removeData("mouseCoords");g.setEventTooltipVisible(k);g.setSuppressEventToolTip(k,false)});c(".fc-event-time, .fc-event-title",m).css("color",m.css("color"));if("agendaWeek"===i.name){m.parent().addClass(j.allDay?"fc-agenda-head":"fc-agenda-body");if(!j.allDay){c(".fc-event-inner",m).css({"border-right-color":j.secondaryBorderColor||j.borderColor,"border-bottom-color":j.secondaryBorderColor||j.borderColor,"border-left-color":j.secondaryBorderColor||j.borderColor})}}if("month"===i.name||"agendaWeek"===i.name){var l;if(c.inArray("other",j.className)!==-1||j.eventType==="custom"){if(j.shortTitle){l=j.shortTitle+": "+j.title}else{if(j.invitees&&j.invitees.length){l=j.invitees[0].displayName+": "+j.title}else{l=j.title}}}else{l=j.shortTitle||j.title}c(".fc-event-title",m).text(l);if("month"===i.name||("agendaWeek"===i.name&&j.allDay)){c(".fc-event-inner",m).before(Confluence.TeamCalendars.Templates.iconEventTypePrinting({eventType:j.className,isCustom:j.eventType==="custom"?true:false}))}}},eventDrop:function(l,j,i,m,k,n){if(g.isEventEditable(n,l)&&!g.isProcessingEvent(n)){f(n,l,j,i,m,k)}else{k()}},eventResize:function(l,j,i,k,m){if(g.isEventEditable(m,l)&&!g.isProcessingEvent(m)){f(m,l,j,i,l.allDay,k)}else{k()}},eventDragStart:function(i){g.setSuppressEventToolTip(i,true);g.setEventTooltipVisible(i);g.hideInlineAuiDialogs()},eventDragEnd:function(i){g.setSuppressEventToolTip(i,false)},eventResizeStart:function(i){g.setSuppressEventToolTip(i,true);g.setEventTooltipVisible(i);g.hideInlineAuiDialogs()},eventResizeStop:function(i){g.setSuppressEventToolTip(i,false)}}};return d});
}catch(e){WRMCB(e)};