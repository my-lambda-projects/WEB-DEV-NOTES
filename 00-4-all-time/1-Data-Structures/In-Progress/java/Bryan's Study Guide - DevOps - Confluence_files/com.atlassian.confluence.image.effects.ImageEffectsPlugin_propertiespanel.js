WRMCB=function(e){var c=console;if(c&&c.log&&c.error){c.log('Error running batched script.');c.error(e);}}
;
try {
/* module-key = 'com.atlassian.confluence.image.effects.ImageEffectsPlugin:propertiespanel', location = 'com/atlassian/confluence/image/effects/property-panel.js' */
AJS.toInit(function(e){var p,i=/(\?|\&)(effects\=[^&]+)($|&)/,t=/(^|\&)(effects\=([^&]+))($|&)/,s=null,j=[],h=2000;q();if(Confluence.Editor.ImageProps){f()}else{l()}function f(){AJS.bind("dialog-created.image-properties",function(x,y){p=y.img;var z="image-effects",w="image-effects-panel";if(!a()){Confluence.Editor.ImageProps.registerPanel(z,c("Image effects can\'t be applied to web images"),w,null)}else{if(!n()){Confluence.Editor.ImageProps.registerPanel(z,c("This image is too large to apply effects. Please make it smaller (less than 4,000,000px in total dimensions) and try again."),w,null)}else{Confluence.Editor.ImageProps.registerPanel("image-effects",c(),"image-effects-panel",r)}}});AJS.bind("dialog-before-show.image-properties",function(){b();o(m(e(p)))})}function l(){var w=new AJS.Dialog({width:600,height:500,id:"image-effects-dialog"});w.addHeader("Add Image Effect");w.addPanel("",c(),"");b();w.addSubmit("Save",function(){var x=v();x.done(function(){w.hide()})});w.addCancel("Close",function(){w.hide()});AJS.Confluence.PropertyPanel.Image.pluginButtons.push(null,{create:function(x){p=x[0];var z=m(x),y=!a();return{className:"image-effects",text:"Effects...",tooltip:y?"Image effects can\'t be applied to web images":"Add an image effect like drop shadow or picture frame",click:function(){if(!n()){alert("This image is too large to apply effects. Please make it smaller (less than 4,000,000px in total dimensions) and try again.");return false}o(m(e(p)));AJS.Confluence.PropertyPanel.destroy();w.show()},disabled:y,selected:!!z}}})}function g(y,A){var B=y.attr("src");var x=i.exec(B);var w=A?"effects="+A:"";if(x){B=B.replace(x[2],w)}else{if(A){B=B+(B.indexOf("?")!=-1?"&":"?")+w}}y.attr("src",B);y.attr("data-mce-src",B);var z=y.attr("confluence-query-params");if(z){var x=t.exec(z);if(x){z=z.replace(x[2],w)}else{z=z+"&"+w}}else{z=w}y.attr("confluence-query-params",z)}function m(x){var y=x.attr("confluence-query-params");var w=t.exec(y);if(w){return w[3]}}function o(w){e(".image-effect-preview.selected").removeClass("selected");if(w){e(j).each(function(x,y){if(y.effects==w){e(e(".image-effect-preview")[x]).addClass("selected");return false}})}else{e(".image-effect-preview.image-effect-none").addClass("selected")}s=w}function q(){j.push({name:"None",effects:null});j.push({name:"Taped",effects:"border-simple,blur-border,tape"});j.push({name:"Instant Camera",effects:"border-polaroid,blur-border"});j.push({name:"Curl Shadow",effects:"border-simple,shadow-kn"});j.push({name:"Snapshot",effects:"border-simple,blur-border"});j.push({name:"Drop Shadow",effects:"drop-shadow"})}function c(w){if(w){return'<div class="aui-message warning"><span class="aui-icon icon-warning"></span>'+w+"</div>"}return'<div class="image-effects"><ul class="image-list"></ul></div>'}function b(){var x=e("div.image-effects ul.image-list");var z=Math.floor(Math.random()*22)+1;for(var y=0;y<j.length;y++){var w=e('<li class="attached-image image-effect-preview'+(!j[y].effects?" image-effect-none":"")+'"><div class="image-container"><img class="thumbnail" src="'+AJS.contextPath()+"/plugins/servlet/imgFilter.png?preview=true&id="+z+"&effects="+j[y].effects+'" title="'+j[y].name+'" style="margin-top: 5px"></div><span class="caption filename" title="'+j[y].name+'">'+j[y].name+"</span></li>");w.hover(function(){e(this).addClass("hover")},function(){e(this).removeClass("hover")});x.append(w);var A=j[y];w.click(A,function(B){e(".image-effect-preview.selected").removeClass("selected");e(this).addClass("selected");s=B.data.effects})}}function a(){return !e(p).hasClass("confluence-external-resource")}function n(){return !(p.naturalHeight&&p.naturalWidth&&(p.naturalHeight*p.naturalWidth)>(h*h))}function r(){return u()}function v(){return u(d,k)}function u(w,z){var y=e.Deferred();w&&w();p.onload=A;var x=p.src;g(e(p),s);if(p.src==x){A()}function A(){z&&z();y.resolve();p.onload=null;tinyMCE.activeEditor.undoManager.add()}return y}function d(){var C=dialog.popup.element,x=50,z=x*13/60,D=x*30/60,w=x-D,y=e('<div class="image-properties-loading-blanket"><div class="loading-data"></div></div>').appendTo(C.find(".dialog-page-body")),B=y.find(".loading-data");y.css({width:y.parent().width(),height:C.height()});B.css({marginTop:-x*1.2,marginLeft:-x*1.2});var A={color:"#666",width:z,radius:D,length:w,top:0,left:0,zIndex:0,speed:1.042};B.spin(A)}function k(){var w=dialog.popup.element.find(".image-properties-loading-blanket .loading-data");w.css({marginTop:"",marginLeft:""});w.spinStop();w.closest(".image-properties-loading-blanket").remove()}});
}catch(e){WRMCB(e)};