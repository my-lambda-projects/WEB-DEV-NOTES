<h1 id="creating-with-associations">Creating with Associations</h1>
<p>An instance can be created with nested association in one step, provided all elements are new.</p>
<p>In contrast, performing updates and deletions involving nested objects is currently not possible. For that, you will have to perform each separate action explicitly.</p>
<h2 id="belongsto-hasmany-hasone-association">BelongsTo / HasMany / HasOne association</h2>
<p>Consider the following models:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">class</span> Product <span class="kw">extends</span> Model <span class="op">{}</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="va">Product</span>.<span class="at">init</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb1-3" title="3">  <span class="dt">title</span><span class="op">:</span> <span class="va">Sequelize</span>.<span class="at">STRING</span></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="op">},</span> <span class="op">{</span> sequelize<span class="op">,</span> <span class="dt">modelName</span><span class="op">:</span> <span class="st">&#39;product&#39;</span> <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="kw">class</span> User <span class="kw">extends</span> Model <span class="op">{}</span></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="va">User</span>.<span class="at">init</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb1-7" title="7">  <span class="dt">firstName</span><span class="op">:</span> <span class="va">Sequelize</span>.<span class="at">STRING</span><span class="op">,</span></a>
<a class="sourceLine" id="cb1-8" title="8">  <span class="dt">lastName</span><span class="op">:</span> <span class="va">Sequelize</span>.<span class="at">STRING</span></a>
<a class="sourceLine" id="cb1-9" title="9"><span class="op">},</span> <span class="op">{</span> sequelize<span class="op">,</span> <span class="dt">modelName</span><span class="op">:</span> <span class="st">&#39;user&#39;</span> <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-10" title="10"><span class="kw">class</span> Address <span class="kw">extends</span> Model <span class="op">{}</span></a>
<a class="sourceLine" id="cb1-11" title="11"><span class="va">Address</span>.<span class="at">init</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb1-12" title="12">  <span class="dt">type</span><span class="op">:</span> <span class="va">DataTypes</span>.<span class="at">STRING</span><span class="op">,</span></a>
<a class="sourceLine" id="cb1-13" title="13">  <span class="dt">line1</span><span class="op">:</span> <span class="va">Sequelize</span>.<span class="at">STRING</span><span class="op">,</span></a>
<a class="sourceLine" id="cb1-14" title="14">  <span class="dt">line2</span><span class="op">:</span> <span class="va">Sequelize</span>.<span class="at">STRING</span><span class="op">,</span></a>
<a class="sourceLine" id="cb1-15" title="15">  <span class="dt">city</span><span class="op">:</span> <span class="va">Sequelize</span>.<span class="at">STRING</span><span class="op">,</span></a>
<a class="sourceLine" id="cb1-16" title="16">  <span class="dt">state</span><span class="op">:</span> <span class="va">Sequelize</span>.<span class="at">STRING</span><span class="op">,</span></a>
<a class="sourceLine" id="cb1-17" title="17">  <span class="dt">zip</span><span class="op">:</span> <span class="va">Sequelize</span>.<span class="at">STRING</span><span class="op">,</span></a>
<a class="sourceLine" id="cb1-18" title="18"><span class="op">},</span> <span class="op">{</span> sequelize<span class="op">,</span> <span class="dt">modelName</span><span class="op">:</span> <span class="st">&#39;address&#39;</span> <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-19" title="19"></a>
<a class="sourceLine" id="cb1-20" title="20"><span class="co">// We save the return values of the association setup calls to use them later</span></a>
<a class="sourceLine" id="cb1-21" title="21"><span class="va">Product</span>.<span class="at">User</span> <span class="op">=</span> <span class="va">Product</span>.<span class="at">belongsTo</span>(User)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-22" title="22"><span class="va">User</span>.<span class="at">Addresses</span> <span class="op">=</span> <span class="va">User</span>.<span class="at">hasMany</span>(Address)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-23" title="23"><span class="co">// Also works for `hasOne`</span></a></code></pre></div>
<p>A new <code>Product</code>, <code>User</code>, and one or more <code>Address</code> can be created in one step in the following way:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" title="1"><span class="cf">return</span> <span class="va">Product</span>.<span class="at">create</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb2-2" title="2">  <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;Chair&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb2-3" title="3">  <span class="dt">user</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb2-4" title="4">    <span class="dt">firstName</span><span class="op">:</span> <span class="st">&#39;Mick&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb2-5" title="5">    <span class="dt">lastName</span><span class="op">:</span> <span class="st">&#39;Broadstone&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb2-6" title="6">    <span class="dt">addresses</span><span class="op">:</span> [<span class="op">{</span></a>
<a class="sourceLine" id="cb2-7" title="7">      <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;home&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb2-8" title="8">      <span class="dt">line1</span><span class="op">:</span> <span class="st">&#39;100 Main St.&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb2-9" title="9">      <span class="dt">city</span><span class="op">:</span> <span class="st">&#39;Austin&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb2-10" title="10">      <span class="dt">state</span><span class="op">:</span> <span class="st">&#39;TX&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb2-11" title="11">      <span class="dt">zip</span><span class="op">:</span> <span class="st">&#39;78704&#39;</span></a>
<a class="sourceLine" id="cb2-12" title="12">    <span class="op">}</span>]</a>
<a class="sourceLine" id="cb2-13" title="13">  <span class="op">}</span></a>
<a class="sourceLine" id="cb2-14" title="14"><span class="op">},</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb2-15" title="15">  <span class="dt">include</span><span class="op">:</span> [<span class="op">{</span></a>
<a class="sourceLine" id="cb2-16" title="16">    <span class="dt">association</span><span class="op">:</span> <span class="va">Product</span>.<span class="at">User</span><span class="op">,</span></a>
<a class="sourceLine" id="cb2-17" title="17">    <span class="dt">include</span><span class="op">:</span> [ <span class="va">User</span>.<span class="at">Addresses</span> ]</a>
<a class="sourceLine" id="cb2-18" title="18">  <span class="op">}</span>]</a>
<a class="sourceLine" id="cb2-19" title="19"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Observe the usage of the <code>include</code> option in the <code>Product.create</code> call. That is necessary for Sequelize to understand what you are trying to create along with the association.</p>
<p>Note: here, our user model is called <code>user</code>, with a lowercase <code>u</code> - This means that the property in the object should also be <code>user</code>. If the name given to <code>sequelize.define</code> was <code>User</code>, the key in the object should also be <code>User</code>. Likewise for <code>addresses</code>, except it’s pluralized being a <code>hasMany</code> association.</p>
<h2 id="belongsto-association-with-an-alias">BelongsTo association with an alias</h2>
<p>The previous example can be extended to support an association alias.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">const</span> Creator <span class="op">=</span> <span class="va">Product</span>.<span class="at">belongsTo</span>(User<span class="op">,</span> <span class="op">{</span> <span class="dt">as</span><span class="op">:</span> <span class="st">&#39;creator&#39;</span> <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-2" title="2"></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="cf">return</span> <span class="va">Product</span>.<span class="at">create</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb3-4" title="4">  <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;Chair&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-5" title="5">  <span class="dt">creator</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb3-6" title="6">    <span class="dt">firstName</span><span class="op">:</span> <span class="st">&#39;Matt&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-7" title="7">    <span class="dt">lastName</span><span class="op">:</span> <span class="st">&#39;Hansen&#39;</span></a>
<a class="sourceLine" id="cb3-8" title="8">  <span class="op">}</span></a>
<a class="sourceLine" id="cb3-9" title="9"><span class="op">},</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb3-10" title="10">  <span class="dt">include</span><span class="op">:</span> [ Creator ]</a>
<a class="sourceLine" id="cb3-11" title="11"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<h2 id="hasmany-belongstomany-association">HasMany / BelongsToMany association</h2>
<p>Let’s introduce the ability to associate a product with many tags. Setting up the models could look like:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">class</span> Tag <span class="kw">extends</span> Model <span class="op">{}</span></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="va">Tag</span>.<span class="at">init</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb4-3" title="3">  <span class="dt">name</span><span class="op">:</span> <span class="va">Sequelize</span>.<span class="at">STRING</span></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="op">},</span> <span class="op">{</span> sequelize<span class="op">,</span> <span class="dt">modelName</span><span class="op">:</span> <span class="st">&#39;tag&#39;</span> <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-5" title="5"></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="va">Product</span>.<span class="at">hasMany</span>(Tag)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="co">// Also works for `belongsToMany`.</span></a></code></pre></div>
<p>Now we can create a product with multiple tags in the following way:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1"><span class="va">Product</span>.<span class="at">create</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb5-2" title="2">  <span class="dt">id</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></a>
<a class="sourceLine" id="cb5-3" title="3">  <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;Chair&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb5-4" title="4">  <span class="dt">tags</span><span class="op">:</span> [</a>
<a class="sourceLine" id="cb5-5" title="5">    <span class="op">{</span> <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;Alpha&#39;</span><span class="op">},</span></a>
<a class="sourceLine" id="cb5-6" title="6">    <span class="op">{</span> <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;Beta&#39;</span><span class="op">}</span></a>
<a class="sourceLine" id="cb5-7" title="7">  ]</a>
<a class="sourceLine" id="cb5-8" title="8"><span class="op">},</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb5-9" title="9">  <span class="dt">include</span><span class="op">:</span> [ Tag ]</a>
<a class="sourceLine" id="cb5-10" title="10"><span class="op">}</span>)</a></code></pre></div>
<p>And, we can modify this example to support an alias as well:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">const</span> Categories <span class="op">=</span> <span class="va">Product</span>.<span class="at">hasMany</span>(Tag<span class="op">,</span> <span class="op">{</span> <span class="dt">as</span><span class="op">:</span> <span class="st">&#39;categories&#39;</span> <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-2" title="2"></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="va">Product</span>.<span class="at">create</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb6-4" title="4">  <span class="dt">id</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></a>
<a class="sourceLine" id="cb6-5" title="5">  <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;Chair&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb6-6" title="6">  <span class="dt">categories</span><span class="op">:</span> [</a>
<a class="sourceLine" id="cb6-7" title="7">    <span class="op">{</span> <span class="dt">id</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;Alpha&#39;</span> <span class="op">},</span></a>
<a class="sourceLine" id="cb6-8" title="8">    <span class="op">{</span> <span class="dt">id</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;Beta&#39;</span> <span class="op">}</span></a>
<a class="sourceLine" id="cb6-9" title="9">  ]</a>
<a class="sourceLine" id="cb6-10" title="10"><span class="op">},</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb6-11" title="11">  <span class="dt">include</span><span class="op">:</span> [<span class="op">{</span></a>
<a class="sourceLine" id="cb6-12" title="12">    <span class="dt">association</span><span class="op">:</span> Categories<span class="op">,</span></a>
<a class="sourceLine" id="cb6-13" title="13">    <span class="dt">as</span><span class="op">:</span> <span class="st">&#39;categories&#39;</span></a>
<a class="sourceLine" id="cb6-14" title="14">  <span class="op">}</span>]</a>
<a class="sourceLine" id="cb6-15" title="15"><span class="op">}</span>)</a></code></pre></div>
